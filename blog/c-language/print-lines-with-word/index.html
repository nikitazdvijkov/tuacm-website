<!doctype html>
<html lang="en-US">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<link rel="icon" type="image/x-icon" href="https://tuacm.com/resources/favicon.png">
		<link rel="stylesheet" href="https://tuacm.com/css/nanobs.css">
		<link rel="stylesheet" href="https://tuacm.com/css/general.css">
		<link rel="stylesheet" href="https://tuacm.com/css/article.css">
		<link rel="stylesheet" href="https://tuacm.com/css/code-style/trac+dark.css">
		<link rel="stylesheet" href="https://tuacm.com/css/code-block.css">
		<link rel="stylesheet" href="https://tuacm.com/css/terminal.css">
		<link rel="stylesheet" href="https://tuacm.com/css/aside.css">
		<style>
			.terminal pre {
				color: #AAAAAA;
			}
			.terminal .file {
				color: #298FDD;
				font-weight: bold;
			}
			.terminal .exe {
				color: #4CE64C;
				font-weight: bold;
			}
		</style>
		<link rel="stylesheet" href="https://tuacm.com/css/author-description.css">
		<title>Printing Lines Containing a Specific Word</title>
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-146716017-1"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-146716017-1');
		</script>
	</head>
	<body id="body-handle">
		<div id="webpage-header" class="text-center py-5 mb-5 bg-yellow" style="background: black;">
			<img src="https://tuacm.com/resources/tuacm-logo.svg?sanitize=True" alt="TU ACM logo." style="width: calc(30% + 150px);">
			<div>
				<a href="https://tuacm.com/blog" class="font-weight-bolder" style="color: #DC144C; font-size: calc(1.5em + 1vw);">blog</a>
			</div>
		</div>
		<div>
			<div class="article">
				<div id="article-title"><h1 id="printing-lines-containing-a-specific-word">Printing Lines Containing a Specific Word</h1></div>
				<div id="meta-description">Our first experience with build systems.</div>
				<div id="date-and-tags">Posted 15 January 2020 at 1:26 PM </div>
				<div id="author-box">
					<div id="author-image" style="background: url(https://tuacm.com/authors/joseph-mellor/large.jpg) 50% 50% no-repeat; background-size: auto 50px;"></div>
					<div id="author-name">By Joseph Mellor</div>
				</div>
				<hr style="border: 3px solid black;">
				<i>This is the seventeenth article in the </i>Making Sense of C<i> series.
				In this article, we're going to write some new code and combine it with the code
				we've written in the last article to create a new program that prints out every
				line in a user specified file that contains a user-specified word.</i>
				<h2 id="disclaimer">Disclaimer</h2>
				<p>Since the focus for this article will be on build systems, we won't spend extra
					effort on making sure that we can handle lines of arbitrary lengths. For this
					article, we're going to assume that all lines are guaranteed to be less than
					<code>4095</code> characters. To deal with longer lines, we'd have to know how to
					dynamically allocate memory so we could print out the entire line or we could
					just print out the section of the line with an ellipsis before and after, e.g.
				</p>
				<div class="terminal"><pre>
<span class="terminal-oneline"><b><span style="color:#4CE64C;">user@computer</span></b>:<b><span style="color:#298FDD;">~/dev</span></b>$ ./print-lines-with-word the</span>
200:    ... which I had given to the last individual I had found ...
</pre>
				</div>
				<h2 id="part-one-writing-the-code">Part One: Writing the Code</h2>
				<p>As always, we need to start with our goal and break it up into high-level tasks.
					Just like the last article, we need to know the word and the file to read from.
					Then, if we find the word in a line, we need to print out the line number and
					the line.
				</p>
				<p>Our algorithm currently looks like
				</p>
				<ol>
					<li>Get the user input.
					</li>
					<li>Read through each line and print out the line and the line number if it contains
						the word.
					</li>
				</ol>
				<h3 id="boilerplate-and-trivial-code">Boilerplate and Trivial Code</h3>
				<p>I decided to reuse the name of the <a
					href="../word-counter/#boilerplate-and-trivial-code">section from the last
					article</a> because what we're going to write here will be almost identical to
					the last program since we're taking in the same exact info in the exact same
					way. In fact, I'm just going to copy a part of the program from last time.
				</p>
				<div class="code-blocktable">
<table><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="code-block"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&gt;</span> <span class="n">argc</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;./print-lines-with-word file_name word_to_count</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">program_name</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">word</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="c1">// TODO: Loop through the file and print out lines containing the word</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>				
				</div>
				<h3 id="file-stuff">File Stuff</h3>
				<p>Again, we can do the exact same thing with the file stuff that we did with the
					word counter.
				</p>
				<div class="code-blocktable">
<table><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="code-block"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;str-operations.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&gt;</span> <span class="n">argc</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;./print_lines_with_word file_name word_to_count</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">program_name</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">word</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="hll">    <span class="kt">FILE</span> <span class="o">*</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
</span><span class="hll">    <span class="k">const</span> <span class="kt">int</span> <span class="n">line_sz</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">;</span>
</span><span class="hll">    <span class="kt">char</span> <span class="n">line</span><span class="p">[</span><span class="n">line_sz</span><span class="p">];</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">while</span> <span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line_sz</span><span class="p">,</span> <span class="n">reader</span><span class="p">))</span> <span class="p">{</span>
</span><span class="hll">        <span class="c1">// TODO: Print line if word is found</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="hll">    <span class="n">fclose</span><span class="p">(</span><span class="n">reader</span><span class="p">);</span>
</span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>				
				</div>
				<h3 id="printing-out-lines">Printing Out Lines</h3>
				We already have the mechanism for checking if a word is in a line with count_word_&#8203;in_line.
				If count_word_&#8203;in_line is greater than zero, it means we found the word at least once in
				the line. Now, since count_word_&#8203;in_line changes the line, we need to create a copy.
				<div class="code-blocktable">
<table><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="code-block"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;str-operations.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&gt;</span> <span class="n">argc</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;./print_lines_with_word file_name word_to_count</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">program_name</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">word</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">FILE</span> <span class="o">*</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">line_sz</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">;</span>
<span class="hll">    <span class="kt">char</span> <span class="n">modified_line</span><span class="p">[</span><span class="n">line_sz</span><span class="p">];</span>
</span><span class="hll">    <span class="kt">char</span> <span class="n">unmodified_line</span><span class="p">[</span><span class="n">line_sz</span><span class="p">];</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">while</span> <span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">unmodified_line</span><span class="p">,</span> <span class="n">line_sz</span><span class="p">,</span> <span class="n">reader</span><span class="p">))</span> <span class="p">{</span>
</span><span class="hll">        <span class="n">strncpy</span><span class="p">(</span><span class="n">modified_line</span><span class="p">,</span> <span class="n">unmodified_line</span><span class="p">,</span> <span class="n">line_sz</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span><span class="hll">        <span class="k">if</span> <span class="p">(</span><span class="n">count_word_in_line</span><span class="p">(</span><span class="n">modified_line</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">unmodified_line</span><span class="p">);</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">    <span class="p">}</span>
</span>    <span class="n">fclose</span><span class="p">(</span><span class="n">reader</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>				
				</div>
				<h3 id="line-numbers">Line Numbers</h3>
				<p>We need to keep count of the line we're on and print it out. We also want to add
					a bit of whitespace to the left so the numbers align. We'll assume that the
					number of lines is less than 100000, which means that we need 5 digits of
					padding. We can use the format string <code>%5u</code> to print out the line number with
					the necessary padding.
				</p>
				<div class="code-blocktable">
<table><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="code-block"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;str-operations.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&gt;</span> <span class="n">argc</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;./print_lines_with_word file_name word_to_count</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">program_name</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">word</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">FILE</span> <span class="o">*</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">line_sz</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">modified_line</span><span class="p">[</span><span class="n">line_sz</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">unmodified_line</span><span class="p">[</span><span class="n">line_sz</span><span class="p">];</span>
<span class="hll">    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">line_num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">unmodified_line</span><span class="p">,</span> <span class="n">line_sz</span><span class="p">,</span> <span class="n">reader</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">strncpy</span><span class="p">(</span><span class="n">modified_line</span><span class="p">,</span> <span class="n">unmodified_line</span><span class="p">,</span> <span class="n">line_sz</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">count_word_in_line</span><span class="p">(</span><span class="n">modified_line</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%5u%s&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">unmodified_line</span><span class="p">);</span>
</span>        <span class="p">}</span>
<span class="hll">        <span class="n">line_num</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span>    <span class="p">}</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">reader</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>				
				</div>
				<p>And we're done with the code.
				</p>
				<h2 id="part-two-a-basic-build-system">Part Two: A Basic Build System</h2>
				<p>If we try to compile it with the command we used last time, we'll get the
					following error.
				</p>
			</div>
			<div class="article">
				<div id="author-description-local">
					<img src="https://tuacm.com/authors/joseph-mellor/large.jpg" id="author-description-image" alt="A picture of Joseph Mellor, the author.">
					<div id="author-description-text">
						<p>Joseph Mellor is a Senior at TU majoring in Physics, Computer Science, and
							Math.
							He is also the chief editor of the website and the author of the tumd markdown
							compiler.
							If you want to see more of his work, check out his <a
							href="https://josephmellor.xyz">personal website</a>.
							<br>
							Credit to Allison Pennybaker for the picture.
						</p>
					</div>
				</div>
			</div>
			<nav id="sidenav">
				<a href="#printing-lines-containing-a-specific-word" style="padding-left:12px;">Printing Lines Containing a Specific Word</a>
				<a href="#disclaimer" style="padding-left:24px;">Disclaimer</a>
				<a href="#part-one-writing-the-code" style="padding-left:24px;">Part One: Writing the Code</a>
				<a href="#boilerplate-and-trivial-code" style="padding-left:36px;">Boilerplate and Trivial Code</a>
				<a href="#file-stuff" style="padding-left:36px;">File Stuff</a>
				<a href="#printing-out-lines" style="padding-left:36px;">Printing Out Lines</a>
				<a href="#line-numbers" style="padding-left:36px;">Line Numbers</a>
				<a href="#part-two-a-basic-build-system" style="padding-left:24px;">Part Two: A Basic Build System</a>
			</nav>
			<div id="sidenav-activator"></div>
		</div>
		<div id="footer" class="mt-5 py-5 text-center px-4">
			<div id="footer-links">
				<a href="#">Blog</a>
				<a href="#">Get Involved</a>
				<a href="http://hacktulsa.com">Hackathon</a>
				<a href="#">GitHub</a>
			</div>
		</div>
		<script src="https://tuacm.com/js/sidenav.js"></script>
	</body>
</html>
